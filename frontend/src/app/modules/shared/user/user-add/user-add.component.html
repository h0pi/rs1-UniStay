@if (wizardService.isOpen()) {
  <div class="wizard-overlay" (click)="closeWizard()">
    <div class="wizard-container" (click)="$event.stopPropagation()">
      <button (click)="closeWizard()" class="wizard-close-button" aria-label="Close registration form">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>

      <!-- Step Indicator -->
      <div class="step-indicator">
        @for(step of steps; track step.number) {
          <div class="step" [class.step--active]="step.number === currentStep()" [class.step--completed]="step.number < currentStep()">
            <div class="step__number">{{ step.number }}</div>
            <div class="step__label">{{ step.label }}</div>
          </div>
        }
      </div>

      <!-- Form -->
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="wizard-form">
        <div class="wizard-content">
          @switch (currentStep()) {
            @case (1) {
              <div formGroupName="step1" class="form-step form-step--active">
                <h2 class="step-title">Personal Information</h2>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input id="firstName" formControlName="firstName" type="text" placeholder="e.g., Jane">
                  </div>
                  <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input id="lastName" formControlName="lastName" type="text" placeholder="e.g., Doe">
                  </div>
                </div>
              </div>
            }
            @case (2) {
              <div formGroupName="step2" class="form-step form-step--active">
                <h2 class="step-title">Date of Birth</h2>
                <div class="form-group">
                  <label for="dateOfBirth">Birth Date</label>
                  <input id="dateOfBirth" formControlName="dateOfBirth" type="date">
                </div>
              </div>
            }
            @case (3) {
              <div formGroupName="step3" class="form-step form-step--active">
                <h2 class="step-title">Contact Information</h2>
                <div class="form-group">
                  <label for="email">Email Address</label>
                  <input id="email" formControlName="email" type="email" placeholder="jane.doe@example.com">
                </div>
              </div>
            }
            @case (4) {
              <div formGroupName="step4" class="form-step form-step--active">
                <h2 class="step-title">Create Your Password</h2>
                <!-- Password -->
                <div class="form-group">
                  <label for="password">Password</label>
                  <div class="password-wrapper">
                    <input id="password" formControlName="password" [type]="showPassword() ? 'text' : 'password'">
                    <button type="button" (click)="togglePasswordVisibility()" class="password-toggle" aria-label="Toggle password visibility">
                      <!--
                      <svg *ngIf="!showPassword()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                      <svg *ngIf="showPassword()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" /></svg>
                      -->
                      <svg xmlns="http://www.w3.org/2000/svg"
                           fill="none" viewBox="0 0 24 24"
                           stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              [attr.d]="showPassword() ? eyeSlashIcon : eyeIcon"/>
                      </svg>
                    </button>
                  </div>
                </div>





                <!-- Password Strength -->
                <!--<div class="password-strength">
                  <div class="strength-bar" [class.strength-bar--1]="passwordStrength() >= 1" [class.strength-bar--2]="passwordStrength() >= 2" [class.strength-bar--3]="passwordStrength() >= 3" [class.strength-bar--4]="passwordStrength() >= 4" [class.strength-bar--5]="passwordStrength() >= 5"></div>
                </div>
                <ul class="strength-criteria">
                  <li [class.valid]="passwordCriteria().length">
                    8+ characters
                  </li>
                  <li [class.valid]="passwordCriteria().upper">
                    1 uppercase
                  </li>
                  <li [class.valid]="passwordCriteria().lower">
                    1 lowercase
                  </li>
                  <li [class.valid]="passwordCriteria().number">
                    1 number
                  </li>
                  <li [class.valid]="passwordCriteria().symbol">
                    1 symbol
                  </li>
                </ul>-->
                <!-- Confirm Password -->
                <div class="form-group">
                  <label for="confirmPassword">Confirm Password</label>
                  <div class="password-wrapper">
                    <input id="confirmPassword" formControlName="confirmPassword" [type]="showConfirmPassword() ? 'text' : 'password'">
                    <button type="button" (click)="toggleConfirmPasswordVisibility()" class="password-toggle" aria-label="Toggle confirm password visibility">
                      <svg *ngIf="!showConfirmPassword()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                      <svg *ngIf="showConfirmPassword()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" /></svg>
                    </button>
                  </div>
                  @if (userForm.get('step4')?.hasError('passwordsMismatch') && userForm.get('step4.confirmPassword')?.touched) {
                    <p class="error-message">Passwords do not match.</p>
                  }
                </div>
              </div>
            }
            @case (5) {
              <div formGroupName="step5" class="form-step form-step--active">
                <h2 class="step-title">Phone Number</h2>
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input id="phone" formControlName="phone" type="tel" placeholder="+1234567890">
                </div>
              </div>
            }
            @case (6) {
              <div formGroupName="step6" class="form-step form-step--active">
                <h2 class="step-title">Choose a Username (Optional)</h2>
                <div class="form-group">
                  <label for="username">Username</label>
                  <input id="username" formControlName="username" type="text" placeholder="e.g., jane_doe_24">
                </div>
              </div>
            }
          }
        </div>

        <!-- Navigation -->
        <div class="wizard-navigation">
          @if (currentStep() > 1) {
            <button type="button" class="wizard-button wizard-button--secondary" (click)="prevStep()">Previous</button>
          }
          @if (currentStep() < steps.length) {
            <button type="button" class="wizard-button wizard-button--primary" [disabled]="!isCurrentStepValid" (click)="nextStep()">Next</button>
          }
          @if (currentStep() === steps.length) {
            <button type="button" class="wizard-button wizard-button--secondary" (click)="skipAndSubmit()">Skip & Finish</button>
            <button type="submit" class="wizard-button wizard-button--primary" [disabled]="!userForm.valid">Create Account</button>
          }
        </div>
      </form>
    </div>
  </div>
}
